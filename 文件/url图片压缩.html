<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>url图片压缩</title>
</head>
<body>
<script>
	function getBase64(img, width, height) { //width、height调用时传入具体像素值，控制大小 ,不传则默认图像大小
		console.log(img.src.length)
		var canvas = document.createElement("canvas");
		canvas.width = width ? width : img.width;
		canvas.height = height ? height : img.height;

		var ctx = canvas.getContext("2d");
		ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
		var dataURL = canvas.toDataURL('image/jpeg');


		var str = dataURL.split(",")[1];
		var equalIndex = str.indexOf("=");
		if (str.indexOf("=") > 0) {
			str = str.substring(0, equalIndex);
		}
		var strLength = str.length;
		var fileLength = parseInt(strLength - (strLength / 8) * 2);
		if (dataURL && fileLength > 5242880) {
			console.log("上传失败，请上传小于5M的图片！");
		} else {
			return canvas.toDataURL('image/jpeg', 0.6);
		}
	}

	try {
		var image = new Image();
		image.crossOrigin = '';
		image.src = 'https://images.pexels.com/photos/2227826/pexels-photo-2227826.jpeg';
		image.onload = function () {
			let baseStr = getBase64(image);
			console.log(baseStr)
		}
	} catch (err) {
		console.log(err)
	}
</script>
</body>
</html>
